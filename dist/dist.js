function page(e){$(document.body).append("<div id='map_box'><div id='map_btn'></div><div id='map'></div></div>"),$(document.body).append("<div id='content'><div id='main'></div></div>"),$("#content").append("<div id='thumbnail' class='picture-grid'></div>");mapboxgl.accessToken="pk.eyJ1IjoiaWZvb2J0b29rIiwiYSI6ImNqdnczZ3plODF5dDE0YW5uNGhpNWcyanAifQ.qgmnnkw85aN0xuI2HVcgHw";var t=new mapboxgl.Map({container:"map",style:"mapbox://styles/ifoobtook/cjxyf0hmg0si11crleexlnv3c",maxZoom:18,zoom:2,center:[121.44,31.75],attributionControl:!1,logoPosition:"bottom-left"}),a=new mapboxgl.LngLatBounds,n=[];function o(e){t.flyTo({center:e.geometry.coordinates,zoom:16.4})}t.addControl(new mapboxgl.AttributionControl,"top-right"),t.on("load",(function(){t.addLayer({id:"tms",type:"raster",source:{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256}})}));var r=document.getElementById("main"),d=r.appendChild(document.createElement("span"));d.className="main_title",d.innerHTML=e.title;var l=r.appendChild(document.createElement("span"));l.className="main_info",l.innerHTML=e.imgShowDate;var m,s=document.getElementById("map_btn").appendChild(document.createElement("img"));s.src="expand.png",s.className="map_expand",s.style="CURSOR: pointer",s.onclick=function(){auto_zoom()},e.features.forEach((function(e,i){var o=i+1;a.extend(e.geometry.coordinates);var r=Number(e.properties.rotation),d=e.geometry.coordinates[0],l=e.geometry.coordinates[1];n.push([Number(d),Number(l)]);var m=document.createElement("div");m.className="marker",m.id="marker-"+o;var s=document.createElement("div");s.className="marker_title",s.innerHTML="<span><b>"+e.properties.imgPosition+"</b></span>";var c=document.createElement("div");c.className="marker_index",c.innerHTML="<p>"+o+"</p>",new mapboxgl.Marker(m,{offset:[0,0],rotation:r,rotationAlignment:"map",pitchAlignment:"map"}).setLngLat(e.geometry.coordinates).addTo(t),new mapboxgl.Marker(c,{offset:[0,0],rotationAlignment:"map",pitchAlignment:"map"}).setLngLat(e.geometry.coordinates).setPopup(new mapboxgl.Popup({offset:25}).setHTML(`<img src="${e.properties.url}?imageView2/2/w/400/h/400/format/jpg/q/75" class="marker_thumbnail"/>`)).addTo(t),c.addEventListener("click",(function(a){var n;n=e,t.flyTo({center:n.geometry.coordinates,zoom:16.4})}))})),auto_zoom=function(){t.fitBounds(a,{padding:100,maxZoom:18})},auto_zoom(),function(e){for(i=0;i<e.features.length;i++){var t=i+1,a=e.features[i].properties,n=a.url+"?imageView2/1/w/200/h/200/format/jpg/q/75",r=document.getElementById("thumbnail").appendChild(document.createElement("div"));r.className="grid-box",r.id="thumbnail-"+t;var d=r.appendChild(document.createElement("div"));d.className="thumnail_imgbox";var l=d.appendChild(document.createElement("img"));l.src=""!=n?n:a.imgUrl,l.className="thumbnail_img",l.dataPosition=i;var m=r.appendChild(document.createElement("div"));m.className="thumnail_num",m.dataPosition=i,m.innerHTML="<p>"+t+"</p>";var s=r.appendChild(document.createElement("div"));s.className="thumnail_date",s.innerHTML="<p>"+a.time+"</p>",l.addEventListener("click",(function(t){o(e.features[this.dataPosition])})),m.addEventListener("click",(function(t){o(e.features[this.dataPosition])}))}}(e),m=turf.lineString(n),t.on("load",(function(){t.addLayer({id:"route",type:"line",source:{type:"geojson",data:m},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#0192FA","line-opacity":.5,"line-width":2}})})),t.on("zoom",(function(){t.getZoom()<16.4?($(".marker_index").addClass("display_off"),$(".marker_index").removeClass("display_on"),$(".marker").addClass("scale_small")):($(".marker_index").addClass("display_on"),$(".marker_index").removeClass("display_off"),$(".marker").removeClass("scale_small"))}))}!function(){var e="@charset \"utf-8\";html{color:#000;background:#fff;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}html *{outline:0;-webkit-text-size-adjust:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}html,body{font-family:sans-serif}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td,hr,button,article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{margin:0;padding:0}input,select,textarea{font-size:100%}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}abbr,acronym{border:0;font-variant:normal}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:500}ol,ul{list-style:none}caption,th{text-align:left}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:500}q:before,q:after{content:''}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a:hover{text-decoration:underline}ins,a{text-decoration:none}",t=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(t),t.styleSheet)t.styleSheet.disabled||(t.styleSheet.cssText=e);else try{t.innerHTML=e}catch(a){t.innerText=e}}(),function(e,t){function a(){var t=o.getBoundingClientRect().width;t/l>540&&(t=540*l);var a=t/10;o.style.fontSize=a+"px",s.rem=e.rem=a}var n,i=e.document,o=i.documentElement,r=i.querySelector('meta[name="viewport"]'),d=i.querySelector('meta[name="flexible"]'),l=0,m=0,s=t.flexible||(t.flexible={});if(r){console.warn("将根据已有的meta标签来设置缩放比例");var c=r.getAttribute("content").match(/initial\-scale=([\d\.]+)/);c&&(m=parseFloat(c[1]),l=parseInt(1/m))}else if(d){var p=d.getAttribute("content");if(p){var u=p.match(/initial\-dpr=([\d\.]+)/),f=p.match(/maximum\-dpr=([\d\.]+)/);u&&(l=parseFloat(u[1]),m=parseFloat((1/l).toFixed(2))),f&&(l=parseFloat(f[1]),m=parseFloat((1/l).toFixed(2)))}}if(!l&&!m){var h=(e.navigator.appVersion.match(/android/gi),e.navigator.appVersion.match(/iphone/gi)),g=e.devicePixelRatio;m=1/(l=h?g>=3&&(!l||l>=3)?3:g>=2&&(!l||l>=2)?2:1:1)}if(o.setAttribute("data-dpr",l),!r)if((r=i.createElement("meta")).setAttribute("name","viewport"),r.setAttribute("content","initial-scale="+m+", maximum-scale="+m+", minimum-scale="+m+", user-scalable=no"),o.firstElementChild)o.firstElementChild.appendChild(r);else{var v=i.createElement("div");v.appendChild(r),i.write(v.innerHTML)}e.addEventListener("resize",(function(){clearTimeout(n),n=setTimeout(a,300)}),!1),e.addEventListener("pageshow",(function(e){e.persisted&&(clearTimeout(n),n=setTimeout(a,300))}),!1),"complete"===i.readyState?i.body.style.fontSize=12*l+"px":i.addEventListener("DOMContentLoaded",(function(){i.body.style.fontSize=12*l+"px"}),!1),a(),s.dpr=e.dpr=l,s.refreshRem=a,s.rem2px=function(e){var t=parseFloat(e)*this.rem;return"string"==typeof e&&e.match(/rem$/)&&(t+="px"),t},s.px2rem=function(e){var t=parseFloat(e)/this.rem;return"string"==typeof e&&e.match(/px$/)&&(t+="rem"),t}}(window,window.lib||(window.lib={}));