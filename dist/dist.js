!function(){var a="@charset \"utf-8\";html{color:#000;background:#fff;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}html *{outline:0;-webkit-text-size-adjust:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}html,body{font-family:sans-serif}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td,hr,button,article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{margin:0;padding:0}input,select,textarea{font-size:100%}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}abbr,acronym{border:0;font-variant:normal}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:500}ol,ul{list-style:none}caption,th{text-align:left}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:500}q:before,q:after{content:''}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a:hover{text-decoration:underline}ins,a{text-decoration:none}",b=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet)b.styleSheet.disabled||(b.styleSheet.cssText=a);else try{b.innerHTML=a}catch(c){b.innerText=a}}();
!function(a,b){function c(){var b=f.getBoundingClientRect().width;b/i>540&&(b=540*i);var c=b/10;f.style.fontSize=c+"px",k.rem=a.rem=c}var d,e=a.document,f=e.documentElement,g=e.querySelector('meta[name="viewport"]'),h=e.querySelector('meta[name="flexible"]'),i=0,j=0,k=b.flexible||(b.flexible={});if(g){console.warn("将根据已有的meta标签来设置缩放比例");var l=g.getAttribute("content").match(/initial\-scale=([\d\.]+)/);l&&(j=parseFloat(l[1]),i=parseInt(1/j))}else if(h){var m=h.getAttribute("content");if(m){var n=m.match(/initial\-dpr=([\d\.]+)/),o=m.match(/maximum\-dpr=([\d\.]+)/);n&&(i=parseFloat(n[1]),j=parseFloat((1/i).toFixed(2))),o&&(i=parseFloat(o[1]),j=parseFloat((1/i).toFixed(2)))}}if(!i&&!j){var p=(a.navigator.appVersion.match(/android/gi),a.navigator.appVersion.match(/iphone/gi)),q=a.devicePixelRatio;i=p?q>=3&&(!i||i>=3)?3:q>=2&&(!i||i>=2)?2:1:1,j=1/i}if(f.setAttribute("data-dpr",i),!g)if(g=e.createElement("meta"),g.setAttribute("name","viewport"),g.setAttribute("content","initial-scale="+j+", maximum-scale="+j+", minimum-scale="+j+", user-scalable=no"),f.firstElementChild)f.firstElementChild.appendChild(g);else{var r=e.createElement("div");r.appendChild(g),e.write(r.innerHTML)}a.addEventListener("resize",function(){clearTimeout(d),d=setTimeout(c,300)},!1),a.addEventListener("pageshow",function(a){a.persisted&&(clearTimeout(d),d=setTimeout(c,300))},!1),"complete"===e.readyState?e.body.style.fontSize=12*i+"px":e.addEventListener("DOMContentLoaded",function(){e.body.style.fontSize=12*i+"px"},!1),c(),k.dpr=a.dpr=i,k.refreshRem=c,k.rem2px=function(a){var b=parseFloat(a)*this.rem;return"string"==typeof a&&a.match(/rem$/)&&(b+="px"),b},k.px2rem=function(a){var b=parseFloat(a)/this.rem;return"string"==typeof a&&a.match(/px$/)&&(b+="rem"),b}}(window,window.lib||(window.lib={}));
function page(e){$(document.body).append("<div id='map_box'><div id='map_btn'></div><div id='map'></div></div>"),$(document.body).append("<div id='content'><div id='main'></div></div>"),$("#content").append("<div id='thumbnail' class='picture-grid'></div>"),mapboxgl.accessToken="pk.eyJ1IjoiaWZvb2J0b29rIiwiYSI6ImNqdnczZ3plODF5dDE0YW5uNGhpNWcyanAifQ.qgmnnkw85aN0xuI2HVcgHw";var t=new mapboxgl.Map({container:"map",style:"mapbox://styles/ifoobtook/cjxyf0hmg0si11crleexlnv3c",zoom:2,center:[121.44,31.75],attributionControl:!1,logoPosition:"bottom-left"}),a=new mapboxgl.LngLatBounds,n=[];function o(e){t.flyTo({center:e.geometry.coordinates,zoom:18})}t.addControl(new mapboxgl.AttributionControl,"top-right"),t.on("load",(function(){t.addLayer({id:"tms",type:"raster",source:{type:"raster",tiles:["https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}"],tileSize:256}})}));var r=document.getElementById("main"),m=r.appendChild(document.createElement("span"));m.className="main_title",m.innerHTML=e.title;var d=r.appendChild(document.createElement("span"));d.className="main_info",d.innerHTML=e.imgShowDate;var l,s=document.getElementById("map_btn").appendChild(document.createElement("img"));s.src="expand.png",s.className="map_expand",s.style="CURSOR: pointer",s.onclick=function(){auto_zoom()},e.features.forEach((function(e,i){var o=i+1;a.extend(e.geometry.coordinates);var r=Number(e.properties.rotation),m=e.geometry.coordinates[0],d=e.geometry.coordinates[1];n.push([Number(m),Number(d)]);var l=document.createElement("div");l.className="marker",l.id="marker-"+o;var s=document.createElement("div");s.className="marker_title",s.innerHTML="<span><b>"+e.properties.imgPosition+"</b></span>";var c=document.createElement("div");c.className="marker_index",c.innerHTML="<span><b>"+o+"</b></span>",new mapboxgl.Marker(l,{offset:[0,0],rotation:r,rotationAlignment:"map",pitchAlignment:"map"}).setLngLat(e.geometry.coordinates).addTo(t),new mapboxgl.Marker(c,{offset:[0,0],rotationAlignment:"map",pitchAlignment:"map"}).setLngLat(e.geometry.coordinates).setPopup(new mapboxgl.Popup({offset:25}).setHTML(`<img src="${e.properties.url}?imageView2/2/w/400/h/400/format/jpg/q/75" class="marker_thumbnail"/>`)).addTo(t),c.addEventListener("click",(function(a){var n;n=e,t.flyTo({center:n.geometry.coordinates,zoom:18})}))})),auto_zoom=function(){t.fitBounds(a,{padding:100,maxZoom:20})},auto_zoom(),function(e){for(i=0;i<e.features.length;i++){var t=i+1,a=e.features[i].properties,n=a.url+"?imageView2/1/w/200/h/200/format/jpg/q/75",r=document.getElementById("thumbnail").appendChild(document.createElement("div"));r.className="grid-box",r.id="thumbnail-"+t;var m=r.appendChild(document.createElement("div"));m.className="thumnail_imgbox";var d=m.appendChild(document.createElement("img"));d.src=""!=n?n:a.imgUrl,d.className="thumbnail_img",d.dataPosition=i;var l=r.appendChild(document.createElement("div"));l.className="thumnail_num",l.dataPosition=i,l.innerHTML="<p>"+t+"</p>";var s=r.appendChild(document.createElement("div"));s.className="thumnail_date",s.innerHTML="<p>"+a.time+"</p>",d.addEventListener("click",(function(t){o(e.features[this.dataPosition])})),l.addEventListener("click",(function(t){o(e.features[this.dataPosition])}))}}(e),l=turf.lineString(n),t.on("load",(function(){t.addLayer({id:"route",type:"line",source:{type:"geojson",data:l},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#0192FA","line-opacity":.5,"line-width":2}})})),t.on("zoom",(function(){t.getZoom()<18?($(".marker_index").addClass("display_off"),$(".marker_index").removeClass("display_on"),$(".marker").addClass("scale_small")):($(".marker_index").addClass("display_on"),$(".marker_index").removeClass("display_off"),$(".marker").removeClass("scale_small"))}))}